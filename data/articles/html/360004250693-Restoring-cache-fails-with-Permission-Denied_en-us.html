<p>If you are utilizing <a href="https://circleci.com/docs/2.0/workflows/">Workflows</a> and either saving and <a href="https://circleci.com/docs/2.0/caching/#restoring-cache">restoring cache</a> or <a href="https://circleci.com/docs/2.0/workflows/#using-workspaces-to-share-data-among-jobs">persisting your Workspaces</a>, keep in mind the users and directories involved. If you are using <a href="https://circleci.com/docs/2.0/circleci-images/">CircleCI convenience images</a>, each Docker container runs under the same user with the same base permissions. If you save your cache in a job that uses one image, and it is restored in another, make sure they have compatible permissions.</p>
<p>If you receive the error "<span class="pre"><strong>Permission denied</strong>" when restoring your cache, check where it had been saved in the previous job. A common instance of this is when using an image as the root user and saving cache, then attempting to restore that cache in a later job with a user who does not have root access.<br><br>The same error will cause files in a persisted workspace to be missing as well if the permissions are not set correctly.<br><br></span></p>
<p><span class="pre"><img src="https://support.circleci.com/hc/article_attachments/360005107713/Untitled.png" alt="Untitled.png" width="700" height="348"></span></p>
<p> </p>
<p><span class="pre">You can see here in this `Restoring Cache` step, the cache was originally saved to `<em>/root/</em>tmp` as the original image was running as root and had it's working directory set to `<em>~/</em>tmp`. In this part of the Workflow, running under the CircleCI user, we do not have access to the `/root` folder.</span></p>
<p><span class="pre">If possible, use the same image across multiple jobs. If this is not possible, try setting your working directory to a common location between the two images (`/tmp` may work for some). You may need to change or set file permissions before saving your cache. </span></p>
<p><span class="pre">Example: Use `<em>chmod -R 777 ./workingDirectory</em>` to give full read/write access to these files.</span></p>
<p>The best option is to use a common image among your jobs. If the convenience images we provide are missing something essential to your project, consider <a href="https://circleci.com/docs/2.0/custom-images/">customizing one of our images</a>.</p>
<h2>Architecture Permissions Issues</h2>
<p>Caches generated in environments can also run into permissions issues when they are restored in environments that use a different architecture. To prevent these issues try adding the {arch} variable to your cache key. This will make sure that caches are unique to the environment they're generated in.</p>
<pre>- restore_cache: <br>    key: '-v1-node-cache-{{ checksum "yarn.lock" }}-{{ arch}}' <br>- run: name: Install App command: yarn <br>- save_cache: <br>    key: '-v1-node-cache-{{ checksum "yarn.lock" }}-{{ arch }}' <br>    paths: <br>      - node_modules</pre>